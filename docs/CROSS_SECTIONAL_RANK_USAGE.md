# í¬ë¡œìŠ¤ ì„¹ì…”ë„ ë­í¬ (Cross-Sectional Rank) ì‚¬ìš© í˜„í™©

**ì‘ì„±ì¼**: 2026-01-07

---

## ğŸ“Š í•µì‹¬ ê²°ë¡ 

**í¬ë¡œìŠ¤ ì„¹ì…”ë„ ë­í¬ëŠ” L5 ëª¨ë¸ í•™ìŠµì—ì„œ íƒ€ê¹ƒ ë³€í™˜ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.**

- **ì‚¬ìš© ìœ„ì¹˜**: L5 ëª¨ë¸ í•™ìŠµ ë‹¨ê³„ (ë ˆê±°ì‹œ íŒŒì´í”„ë¼ì¸)
- **ì‚¬ìš© ëª©ì **: íƒ€ê¹ƒ ë³€ìˆ˜(ìˆ˜ìµë¥ )ë¥¼ ìƒëŒ€ ìˆœìœ„ë¡œ ë³€í™˜í•˜ì—¬ ëª¨ë¸ í•™ìŠµ
- **íˆ¬íŠ¸ë™ êµ¬ì¡°**: ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (L5 ëª¨ë¸ í•™ìŠµì„ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ)

---

## ğŸ” í¬ë¡œìŠ¤ ì„¹ì…”ë„ ë­í¬ë€?

### ì •ì˜

**Cross-Sectional Rank (CS Rank)**ëŠ” ê°™ì€ ë‚ ì§œì˜ ì—¬ëŸ¬ ì¢…ëª©ì„ ë¹„êµí•˜ì—¬ ìƒëŒ€ ìˆœìœ„ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

**ì˜ˆì‹œ**:
```
ë‚ ì§œ: 2023-01-04
ì¢…ëª© A: ìˆ˜ìµë¥  5%  â†’ rank 0.9 (ìƒìœ„ 10%)
ì¢…ëª© B: ìˆ˜ìµë¥  2%  â†’ rank 0.5 (ì¤‘ê°„)
ì¢…ëª© C: ìˆ˜ìµë¥  -1% â†’ rank 0.1 (í•˜ìœ„ 10%)
```

### ë³€í™˜ ê³µì‹

```python
# src/stages/modeling/l5_train_models.py:229-238
def _cs_rank_by_date(d: pd.DataFrame, col: str, *, center: bool = True) -> np.ndarray:
    """
    dateë³„ cross-sectional rank(pct) ë³€í™˜.
    - center=Trueë©´ [-0.5, 0.5] ë²”ìœ„ë¡œ 0 ì¤‘ì‹¬í™”
    """
    r = d.groupby("date")[col].rank(pct=True)  # 0~1 ë²”ìœ„
    if center:
        r = r - 0.5  # [-0.5, 0.5] ë²”ìœ„ë¡œ 0 ì¤‘ì‹¬í™”
    return r.to_numpy(dtype=np.float32, copy=False)
```

**ë³€í™˜ ê³¼ì •**:
1. ê°™ì€ ë‚ ì§œì˜ ì¢…ëª©ë“¤ì„ ê·¸ë£¹í™”
2. ìˆ˜ìµë¥ ì„ percentile rankë¡œ ë³€í™˜ (0~1 ë²”ìœ„)
3. center=Trueë©´ 0.5ë¥¼ ë¹¼ì„œ [-0.5, 0.5] ë²”ìœ„ë¡œ ë³€í™˜

---

## ğŸ¯ ì‚¬ìš© ìœ„ì¹˜: L5 ëª¨ë¸ í•™ìŠµ

### ë ˆê±°ì‹œ íŒŒì´í”„ë¼ì¸ (L0~L7)

**íŒŒì¼**: `src/stages/modeling/l5_train_models.py`

**ì„¤ì •**: `configs/config.yaml`
```yaml
l5:
  target_transform: cs_rank  # Cross-Sectional Rank ë³€í™˜
  cs_rank_center: true        # 0 ì¤‘ì‹¬í™” í™œì„±í™”
```

**ì‚¬ìš© ì‹œì **: ëª¨ë¸ í•™ìŠµ ì „ íƒ€ê¹ƒ ë³€ìˆ˜ ë³€í™˜

```python
# l5_train_models.py:606-608
if target_transform == "cs_rank":
    y_train = _cs_rank_by_date(dtrain, target_col, center=cs_rank_center)
    y_test_metric = _cs_rank_by_date(dtest, target_col, center=cs_rank_center)
```

**ì²˜ë¦¬ íë¦„**:
```
1. ì›ë³¸ íƒ€ê¹ƒ: ret_fwd_20d (ì ˆëŒ€ ìˆ˜ìµë¥ , ì˜ˆ: 0.05 = 5%)
   â†“
2. CS Rank ë³€í™˜: ê°™ì€ ë‚ ì§œ ì¢…ëª©ë“¤ì„ ìƒëŒ€ ìˆœìœ„ë¡œ ë³€í™˜
   - ì˜ˆ: 0.05 â†’ 0.9 (ìƒìœ„ 10%)
   â†“
3. 0 ì¤‘ì‹¬í™”: 0.9 - 0.5 = 0.4 ([-0.5, 0.5] ë²”ìœ„)
   â†“
4. ëª¨ë¸ í•™ìŠµ: Ridge íšŒê·€ ëª¨ë¸ì´ ë³€í™˜ëœ íƒ€ê¹ƒìœ¼ë¡œ í•™ìŠµ
```

---

## ğŸ¤” ì™œ ì‚¬ìš©í•˜ë‚˜ìš”?

### 1. ìƒëŒ€ í‰ê°€ ê°•í™”

**ë¬¸ì œ**: ì ˆëŒ€ ìˆ˜ìµë¥ ì€ ì‹œì¥ í™˜ê²½ì— ë”°ë¼ ìŠ¤ì¼€ì¼ì´ ë‹¬ë¼ì§
- ì˜ˆ: 2020ë…„ ìƒìŠ¹ì¥ì—ì„œëŠ” ëª¨ë“  ì¢…ëª©ì´ +10% ì´ìƒ
- ì˜ˆ: 2022ë…„ í•˜ë½ì¥ì—ì„œëŠ” ëª¨ë“  ì¢…ëª©ì´ -5% ì´í•˜

**í•´ê²°**: ê°™ì€ ë‚ ì§œì˜ ì¢…ëª©ë“¤ì„ ìƒëŒ€ì ìœ¼ë¡œ ë¹„êµ
- ìƒìŠ¹ì¥ì´ë“  í•˜ë½ì¥ì´ë“  "ìƒìœ„ ì¢…ëª©"ì„ ì‹ë³„ ê°€ëŠ¥
- ì‹œì¥ í™˜ê²½ ë³€í™”ì— ëœ ë¯¼ê°

### 2. ëª¨ë¸ í•™ìŠµ ì•ˆì •ì„±

**ì ˆëŒ€ ìˆ˜ìµë¥  ì‚¬ìš© ì‹œ**:
- ì‹œì¥ í™˜ê²½ ë³€í™”ì— ë”°ë¼ íƒ€ê¹ƒ ë¶„í¬ê°€ í¬ê²Œ ë‹¬ë¼ì§
- ëª¨ë¸ì´ íŠ¹ì • ì‹œì¥ í™˜ê²½ì— ê³¼ì í•©ë  ìœ„í—˜

**CS Rank ì‚¬ìš© ì‹œ**:
- íƒ€ê¹ƒ ë¶„í¬ê°€ í•­ìƒ [-0.5, 0.5] ë²”ìœ„ë¡œ ì¼ì •
- ëª¨ë¸ í•™ìŠµì´ ë” ì•ˆì •ì 

### 3. Cross-Sectional ë¹„êµ ê°•í™”

**ëª©ì **: "ì´ ì¢…ëª©ì´ ê°™ì€ ë‚ ì§œì˜ ë‹¤ë¥¸ ì¢…ëª©ë“¤ë³´ë‹¤ ì–¼ë§ˆë‚˜ ì¢‹ì€ê°€?"

**CS Rank ë³€í™˜**:
- ê°™ì€ ë‚ ì§œì˜ ì¢…ëª©ë“¤ì„ ìƒëŒ€ì ìœ¼ë¡œ í‰ê°€
- "ìƒìœ„ 10%" vs "í•˜ìœ„ 10%" êµ¬ë¶„ ëª…í™•

---

## ğŸ“Š ì‚¬ìš© í˜„í™© ë¹„êµ

| êµ¬ë¶„ | ë ˆê±°ì‹œ íŒŒì´í”„ë¼ì¸ (L5) | íˆ¬íŠ¸ë™ êµ¬ì¡° (Track A/B) |
|------|---------------------|----------------------|
| **CS Rank ì‚¬ìš©** | âœ… ì‚¬ìš© (íƒ€ê¹ƒ ë³€í™˜) | âŒ ì‚¬ìš© ì•ˆ í•¨ |
| **ì‚¬ìš© ìœ„ì¹˜** | L5 ëª¨ë¸ í•™ìŠµ | - |
| **ëª©ì ** | ëª¨ë¸ í•™ìŠµìš© íƒ€ê¹ƒ ë³€í™˜ | - |
| **ì„¤ì •** | `l5.target_transform: cs_rank` | - |

---

## ğŸ”— ê´€ë ¨ ê°œë…

### Cross-Sectional ì •ê·œí™” (L8ì—ì„œ ì‚¬ìš©)

**ì£¼ì˜**: CS Rankì™€ëŠ” ë‹¤ë¥¸ ê°œë…ì…ë‹ˆë‹¤!

**L8 ë­í‚¹ ì—”ì§„**:
- **Cross-Sectional ì •ê·œí™”**: í”¼ì²˜ë¥¼ ë‚ ì§œë³„ë¡œ ì •ê·œí™” (percentile, zscore, robust_zscore)
- **ëª©ì **: í”¼ì²˜ ìŠ¤ì¼€ì¼ í†µì¼

**L5 ëª¨ë¸ í•™ìŠµ**:
- **Cross-Sectional Rank**: íƒ€ê¹ƒ ë³€ìˆ˜ë¥¼ ë‚ ì§œë³„ë¡œ ìˆœìœ„ ë³€í™˜
- **ëª©ì **: ìƒëŒ€ í‰ê°€ ê°•í™”

**ë¹„êµ**:
```python
# L8: í”¼ì²˜ ì •ê·œí™” (Cross-Sectional)
normalized_feature = normalize_feature_cross_sectional(
    df, feature_col="volatility_60d", 
    method="zscore"  # ë˜ëŠ” percentile, robust_zscore
)

# L5: íƒ€ê¹ƒ ë³€í™˜ (Cross-Sectional Rank)
y_cs_rank = _cs_rank_by_date(df, target_col="ret_fwd_20d", center=True)
```

---

## ğŸ“ ì½”ë“œ ìœ„ì¹˜

### í•¨ìˆ˜ ì •ì˜
- **íŒŒì¼**: `src/stages/modeling/l5_train_models.py`
- **í•¨ìˆ˜**: `_cs_rank_by_date()` (line 229-238)

### ì‚¬ìš© ìœ„ì¹˜
- **L5 ëª¨ë¸ í•™ìŠµ**: `train_oos_predictions()` í•¨ìˆ˜ ë‚´ë¶€
  - íƒ€ê¹ƒ ë³€í™˜: line 606-608
  - Alpha íŠœë‹: line 393-395

### ì„¤ì • íŒŒì¼
- **íŒŒì¼**: `configs/config.yaml`
- **ì„¹ì…˜**: `l5.target_transform: cs_rank`
- **ì˜µì…˜**: `l5.cs_rank_center: true`

---

## ğŸ¯ ê²°ë¡ 

**í¬ë¡œìŠ¤ ì„¹ì…”ë„ ë­í¬ëŠ” L5 ëª¨ë¸ í•™ìŠµì—ì„œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.**

1. **ì‚¬ìš© ìœ„ì¹˜**: ë ˆê±°ì‹œ íŒŒì´í”„ë¼ì¸ì˜ L5 ë‹¨ê³„
2. **ëª©ì **: íƒ€ê¹ƒ ë³€ìˆ˜(ìˆ˜ìµë¥ )ë¥¼ ìƒëŒ€ ìˆœìœ„ë¡œ ë³€í™˜í•˜ì—¬ ëª¨ë¸ í•™ìŠµ
3. **íš¨ê³¼**: ìƒëŒ€ í‰ê°€ ê°•í™”, ëª¨ë¸ í•™ìŠµ ì•ˆì •ì„± í–¥ìƒ
4. **íˆ¬íŠ¸ë™ êµ¬ì¡°**: ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (L5 ëª¨ë¸ í•™ìŠµì„ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ)

**ì°¸ê³ **: L8ì˜ Cross-Sectional ì •ê·œí™”ì™€ëŠ” ë‹¤ë¥¸ ê°œë…ì…ë‹ˆë‹¤.

